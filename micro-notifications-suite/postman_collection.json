{
  "info": {
    "name": "Micro Notifications Suite - Postman Collection",
    "_postman_id": "micro-notifications-suite-collection",
    "description": "ColecciÃ³n con peticiones para auth-service y notification-service.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Auth - Register",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"Passw0rd!\",\n  \"phone\": \"+34123456789\"\n}"
        },
        "url": {
          "raw": "{{auth_baseUrl}}/api/auth/register",
          "host": [
            "{{auth_baseUrl}}"
          ],
          "path": [
            "api",
            "auth",
            "register"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Auth - Login",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"Passw0rd!\"\n}"
        },
        "url": {
          "raw": "{{auth_baseUrl}}/api/auth/login",
          "host": [
            "{{auth_baseUrl}}"
          ],
          "path": [
            "api",
            "auth",
            "login"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Guardar token en variable de entorno si login OK",
              "if (pm.response.code === 200) {",
              "  try {",
              "    var body = pm.response.json();",
              "    if (body.token) { pm.environment.set('authToken', body.token); pm.environment.set('userEmail', 'user@example.com'); pm.test('Token guardado en authToken', function(){ pm.expect(body.token).to.be.a('string'); }); }",
              "  } catch (e) { pm.test('Respuesta no JSON', function(){ throw e; }); }",
              "} else {",
              "  pm.test('Login fallido', function(){ pm.expect(pm.response.code).to.equal(200); });",
              "}"
            ]
          }
        }
      ],
      "response": []
    },
    {
      "name": "Auth - Password Reset Request",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": { "mode": "raw", "raw": "{\n  \"email\": \"user@example.com\"\n}" },
        "url": { "raw": "{{auth_baseUrl}}/api/auth/password/reset/request", "host": ["{{auth_baseUrl}}"], "path": ["api","auth","password","reset","request"] }
      },
      "response": []
    },
    {
      "name": "Auth - Password Update",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "X-User-Email", "value": "{{userEmail}}" }
        ],
        "body": { "mode": "raw", "raw": "{\n  \"oldPassword\": \"Passw0rd!\",\n  \"newPassword\": \"NewPassw0rd!\"\n}" },
        "url": { "raw": "{{auth_baseUrl}}/api/auth/password/update", "host": ["{{auth_baseUrl}}"], "path": ["api","auth","password","update"] }
      },
      "response": []
    },
    {
      "name": "Notification - Get Channels",
      "request": {
        "method": "GET",
        "header": [],
        "url": { "raw": "{{notification_baseUrl}}/api/channels", "host": ["{{notification_baseUrl}}"], "path": ["api","channels"] }
      },
      "response": []
    },
    {
      "name": "Notification - Send",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{authToken}}" }
        ],
        "body": { "mode": "raw", "raw": "{\n  \"channels\": [\"email\"],\n  \"recipientEmail\": \"user@example.com\",\n  \"recipientPhone\": \"+34123456789\",\n  \"template\": \"welcome\",\n  \"variables\": {\n    \"name\": \"Usuario\"\n  }\n}" },
        "url": { "raw": "{{notification_baseUrl}}/api/notifications", "host": ["{{notification_baseUrl}}"], "path": ["api","notifications"] }
      },
      "response": []
    },
    {
      "name": "Notification - Schedule",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{authToken}}" } ],
        "body": { "mode": "raw", "raw": "{\n  \"channels\": [\"email\"],\n  \"recipientEmail\": \"user@example.com\",\n  \"recipientPhone\": \"+34123456789\",\n  \"template\": \"reminder\",\n  \"variables\": {},\n  \"sendAt\": \"REPLACE_WITH_ISO_FUTURE_DATETIME\"\n}" },
        "url": { "raw": "{{notification_baseUrl}}/api/notifications/schedule", "host": ["{{notification_baseUrl}}"], "path": ["api","notifications","schedule"] }
      },
      "response": []
    },
    {
      "name": "Notification - Get Status",
      "request": {
        "method": "GET",
        "header": [ { "key": "Authorization", "value": "Bearer {{authToken}}" } ],
        "url": { "raw": "{{notification_baseUrl}}/api/notifications/{{lastNotificationId}}", "host": ["{{notification_baseUrl}}"], "path": ["api","notifications","{{lastNotificationId}}"] }
      },
      "response": []
    },
    {
      "name": "Notification - List",
      "request": {
        "method": "GET",
        "header": [ { "key": "Authorization", "value": "Bearer {{authToken}}" } ],
        "url": { "raw": "{{notification_baseUrl}}/api/notifications?status=&channel=&page=0&size=10", "host": ["{{notification_baseUrl}}"], "path": ["api","notifications"], "query": [ { "key": "status", "value": "" }, { "key": "channel", "value": "" }, { "key": "page", "value": "0" }, { "key": "size", "value": "10" } ] }
      },
      "response": []
    },
    {
      "name": "Auth - Health",
      "request": {
        "method": "GET",
        "header": [],
        "url": { "raw": "{{auth_baseUrl}}/health", "host": ["{{auth_baseUrl}}"], "path": ["health"] }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('status 200', ()=> pm.response.to.have.status(200));",
              "var body = pm.response.json();",
              "pm.test('status UP', ()=> pm.expect(body.status).to.eql('UP'));",
              "if (body.details && body.details.version) pm.environment.set('auth_version', body.details.version);",
              "if (body.details && body.details.startedAt) pm.environment.set('auth_startedAt', body.details.startedAt);",
              "if (body.details && body.details.uptime) pm.environment.set('auth_uptime', body.details.uptime);"
            ]
          }
        }
      ]
    },
    {
      "name": "Auth - Health - Ready",
      "request": { "method": "GET", "header": [], "url": { "raw": "{{auth_baseUrl}}/health/ready", "host": ["{{auth_baseUrl}}"], "path": ["health","ready"] } },
      "event": [ { "listen": "test", "script": { "exec": ["pm.test('status 200', ()=> pm.response.to.have.status(200));","var body = pm.response.json();","pm.test('has readiness check', ()=> pm.expect(body.checks.some(c=>c.name==='Readiness check')).to.be.true);"] } } ]
    },
    {
      "name": "Auth - Health - Live",
      "request": { "method": "GET", "header": [], "url": { "raw": "{{auth_baseUrl}}/health/live", "host": ["{{auth_baseUrl}}"], "path": ["health","live"] } },
      "event": [ { "listen": "test", "script": { "exec": ["pm.test('status 200', ()=> pm.response.to.have.status(200));","var body = pm.response.json();","pm.test('has liveness check', ()=> pm.expect(body.checks.some(c=>c.name==='Liveness check')).to.be.true);"] } } ]
    },
    {
      "name": "Notification - Health",
      "request": { "method": "GET", "header": [], "url": { "raw": "{{notification_baseUrl}}/health", "host": ["{{notification_baseUrl}}"], "path": ["health"] } },
      "event": [ { "listen": "test", "script": { "exec": ["pm.test('status 200', ()=> pm.response.to.have.status(200));","var body = pm.response.json();","pm.test('status UP', ()=> pm.expect(body.status).to.eql('UP'));","if (body.details && body.details.version) pm.environment.set('notification_version', body.details.version);","if (body.details && body.details.startedAt) pm.environment.set('notification_startedAt', body.details.startedAt);","if (body.details && body.details.uptime) pm.environment.set('notification_uptime', body.details.uptime);"] } } ]
    },
    {
      "name": "Notification - Health - Ready",
      "request": { "method": "GET", "header": [], "url": { "raw": "{{notification_baseUrl}}/health/ready", "host": ["{{notification_baseUrl}}"], "path": ["health","ready"] } },
      "event": [ { "listen": "test", "script": { "exec": ["pm.test('status 200', ()=> pm.response.to.have.status(200));","var body = pm.response.json();","pm.test('has readiness check', ()=> pm.expect(body.checks.some(c=>c.name==='Readiness check')).to.be.true);"] } } ]
    },
    {
      "name": "Notification - Health - Live",
      "request": { "method": "GET", "header": [], "url": { "raw": "{{notification_baseUrl}}/health/live", "host": ["{{notification_baseUrl}}"], "path": ["health","live"] } },
      "event": [ { "listen": "test", "script": { "exec": ["pm.test('status 200', ()=> pm.response.to.have.status(200));","var body = pm.response.json();","pm.test('has liveness check', ()=> pm.expect(body.checks.some(c=>c.name==='Liveness check')).to.be.true);"] } } ]
    },
    {
      "name": "Orchestrator - Health",
      "request": { "method": "GET", "header": [], "url": { "raw": "{{orchestrator_baseUrl}}/health", "host": ["{{orchestrator_baseUrl}}"], "path": ["health"] } },
      "event": [ { "listen": "test", "script": { "exec": ["pm.test('status 200', ()=> pm.response.to.have.status(200));","var body = pm.response.json();","pm.test('status UP', ()=> pm.expect(body.status).to.eql('UP'));","if (body.details && body.details.version) pm.environment.set('orchestrator_version', body.details.version);","if (body.details && body.details.startedAt) pm.environment.set('orchestrator_startedAt', body.details.startedAt);","if (body.details && body.details.uptime) pm.environment.set('orchestrator_uptime', body.details.uptime);"] } } ]
    },
    {
      "name": "Orchestrator - Health - Ready",
      "request": { "method": "GET", "header": [], "url": { "raw": "{{orchestrator_baseUrl}}/health/ready", "host": ["{{orchestrator_baseUrl}}"], "path": ["health","ready"] } },
      "event": [ { "listen": "test", "script": { "exec": ["pm.test('status 200', ()=> pm.response.to.have.status(200));","var body = pm.response.json();","pm.test('has readiness check', ()=> pm.expect(body.checks.some(c=>c.name==='Readiness check')).to.be.true);"] } } ]
    },
    {
      "name": "Orchestrator - Health - Live",
      "request": { "method": "GET", "header": [], "url": { "raw": "{{orchestrator_baseUrl}}/health/live", "host": ["{{orchestrator_baseUrl}}"], "path": ["health","live"] } },
      "event": [ { "listen": "test", "script": { "exec": ["pm.test('status 200', ()=> pm.response.to.have.status(200));","var body = pm.response.json();","pm.test('has liveness check', ()=> pm.expect(body.checks.some(c=>c.name==='Liveness check')).to.be.true);"] } } ]
    }
  ],
  "event": [],
  "variable": [
    { "key": "auth_baseUrl", "value": "http://localhost:8081" },
    { "key": "notification_baseUrl", "value": "http://localhost:8082" },
    { "key": "authToken", "value": "" },
    { "key": "userEmail", "value": "user@example.com" },
    { "key": "lastNotificationId", "value": "" }
  ]
}
